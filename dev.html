<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Development and contributing &#8212; treams 0.3.3.dev6+g2b54ebdd documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/pyramid.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="About" href="about.html" />
    <link rel="prev" title="treams.special.cython_special.yv_d" href="generated/treams.special.cython_special.yv_d.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="about.html" title="About"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="generated/treams.special.cython_special.yv_d.html" title="treams.special.cython_special.yv_d"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">treams 0.3.3.dev6+g2b54ebdd documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Development and contributing</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="development-and-contributing">
<h1>Development and contributing<a class="headerlink" href="#development-and-contributing" title="Permalink to this heading">¶</a></h1>
<section id="setting-up-the-development-environment">
<h2>Setting up the development environment<a class="headerlink" href="#setting-up-the-development-environment" title="Permalink to this heading">¶</a></h2>
<p>1.
Clone the repository with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone git@github.com:tfp-photonics/treams.git</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://github.com/tfp-photonics/treams.git</span>
</pre></div>
</div>
<p>and enter the directory</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd treams</span>
</pre></div>
</div>
<p>2.
This step is optional, but you might want to create an environment where treams and the
development tools are created</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda env create --name treams-dev python</span>
</pre></div>
</div>
<p>Activate the environment with:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda activate treams-dev</span>
</pre></div>
</div>
<p>3.
Setup the package with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install -e .</span>
</pre></div>
</div>
<p>This last step makes the program available in the environment independently of the
current folder. This is especially necessary for correctly building the documentation.</p>
</section>
<section id="running-tests">
<h2>Running tests<a class="headerlink" href="#running-tests" title="Permalink to this heading">¶</a></h2>
<p>To install the required packages for testing use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install treams[test,coverage,io]</span>
</pre></div>
</div>
<p>Tests can be run using pytest with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python -m pytest</span>
</pre></div>
</div>
<p>but for development a more fine grained selection can be made by passing a directory or
file as an argument. Additionally, the option <code class="docutils literal notranslate"><span class="pre">-k</span></code> allows to define keywords when
selecting test.</p>
<p>Some integration tests for the module <a class="reference internal" href="generated/treams.lattice.html#module-treams.lattice"><span class="std std-ref">treams.lattice</span></a>
take a long time to finish and are therefore disabled by default. You can add them with
the option <code class="docutils literal notranslate"><span class="pre">--runslow</span></code>.</p>
<p>If coverage reports should be included one can use the option <code class="docutils literal notranslate"><span class="pre">--cov</span> <span class="pre">src/treams</span></code>
(which requires pytest-cov to be installed). However, this will only report on the pure
python files. To also get coverage reports for the cython part, it is necessary to
compile it with linetracing support. This can be achieved by setting the environment
variable <code class="docutils literal notranslate"><span class="pre">CYTHON_COVERAGE</span></code>, for example with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">CYTHON_COVERAGE=1 pip install -e .</span>
</pre></div>
</div>
<p>Make sure that new C code files are generated and that those files are compiled.
Enabling the tracing for getting code coverage slows down the integration tests
considerably. For the coverage calculation only the unit tests are used.</p>
<p>Some test for importing and exporting need gmsh. These tests can be activated with
<code class="docutils literal notranslate"><span class="pre">--rungmsh</span></code> analogous to the option <code class="docutils literal notranslate"><span class="pre">--runslow</span></code> above.</p>
</section>
<section id="building-the-documentation">
<h2>Building the documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this heading">¶</a></h2>
<p>To install the required packages for testing use</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">pip install treams[docs]</span>
</pre></div>
</div>
<p>The documentation is built with sphinx by using</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sphinx-build -b html docs docs/_build/html</span>
</pre></div>
</div>
<p>from the root directory of the package to build the documentation as html pages.
Some figures are automatically created, which requires matplotlib.</p>
<p>The doctests can be run with</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sphinx-build -b doctest docs docs/_build/doctest</span>
</pre></div>
</div>
</section>
<section id="building-the-code-on-windows">
<h2>Building the code on Windows<a class="headerlink" href="#building-the-code-on-windows" title="Permalink to this heading">¶</a></h2>
<p>The main issue with using treams on Windows is the compilation step. For Windows Python
is usually compiled with MSVC for Visual Studio. However, especially for calculations
with complex numbers, Cython creates code that conforms to the (C99-) standard. Thus, it
is not compatible with the non-standard implementation of complex numbers by Microsoft.</p>
<p>Below you find three tested ways, how one can use treams with Windows. The first two
ways actually use a non-Windows version of Python, but have a more straightforward
installation procedure. However, the last one works with Windows’ version of Python e.g.
when installed with conda under Windows.</p>
<section id="windows-subsystem-for-linux">
<h3>Windows Subsystem for Linux<a class="headerlink" href="#windows-subsystem-for-linux" title="Permalink to this heading">¶</a></h3>
<p>The
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux (WSL)</a>
exists on recent versions of Windows. To install it, open the command line interpreter
(cmd.exe) and type <cite>wsl –install</cite>. This step might be enough to be able to run a Linux
kernel. Within WSL all instructions from the rest of the description can be used, e.g.
with the distribution’s Python or a conda-installed Python.</p>
<p>Sometimes it is necessary to use
<a class="reference external" href="https://docs.microsoft.com/en-us/windows/wsl/install-manual">additional steps</a> to
install WSL.</p>
</section>
<section id="pure-msys2">
<h3>Pure MSYS2<a class="headerlink" href="#pure-msys2" title="Permalink to this heading">¶</a></h3>
<p>Using <a class="reference external" href="https://www.msys2.org/">MSYS2</a>, it is also possible to compile and install
treams. First, install MSYS2 and update it according to the instructions. Then, also
install python and, if you want, the dependencies of treams. Otherwise, the dependencies
are installed by pip.</p>
</section>
<section id="compilation-with-mingw-w64">
<h3>Compilation with mingw-w64<a class="headerlink" href="#compilation-with-mingw-w64" title="Permalink to this heading">¶</a></h3>
<p>This is approach is different from the others, since it finally combines binaries from
two different compilers. Although it works and was tested on some systems, it is not
guaranteed that it will work for all systems. The following part describes, how treams
can be built for Windows.</p>
<p>After installing MSYS2 use it to install <code class="docutils literal notranslate"><span class="pre">mingw-w64-x86_64-gcc</span></code>.</p>
<p>The compilation is steered from the command line. First go into the directory of treams.
Then, set up your path by prepending the direction for MSYS2’s mingw64 binaries with
<code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">PATH=C:\msys64\mingw64\bin;%PATH%</span></code> (adjust accordingly if you have installed
MSYS2 with non-default parameters). Check that gcc from MSYS2 is recognized correctly
but make sure that the version of python that is found on the path corresponds to the
Windows Python. With this setup, building binaries should work with <cite>python -m build</cite>.</p>
</section>
</section>
<section id="continuous-integration">
<h2>Continuous integration<a class="headerlink" href="#continuous-integration" title="Permalink to this heading">¶</a></h2>
<p>Using Github actions the steps above (building the documentation, running the doctests,
running the tests with a coverage report, and building for all platforms) are
implemented to run automatically on specific triggers. The relevant files in the
<code class="docutils literal notranslate"><span class="pre">.gihub/workflows</span></code> directory can be also used as examples in addition to the
description above.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="treams.html">Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Development and contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="about.html">About</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="generated/treams.special.cython_special.yv_d.html"
                          title="previous chapter">treams.special.cython_special.yv_d</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="about.html"
                          title="next chapter">About</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/dev.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="about.html" title="About"
             >next</a> |</li>
        <li class="right" >
          <a href="generated/treams.special.cython_special.yv_d.html" title="treams.special.cython_special.yv_d"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">treams 0.3.3.dev6+g2b54ebdd documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Development and contributing</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Dominik Beutel.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.0.1.
    </div>
  </body>
</html>